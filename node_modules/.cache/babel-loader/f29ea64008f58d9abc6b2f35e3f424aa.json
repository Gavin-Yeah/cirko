{"ast":null,"code":"function get_all_post_by_id(firebase, user_id, callback) {\n  get_all_post_id_from_db(firebase, user_id, callback);\n}\n\nfunction get_all_post_id_from_db(firebase, user_id, callback) {\n  //get db reference\n  var db = firebase.db;\n  var docRef = db.collection(\"users\").doc(user_id); //get user\n\n  docRef.get().then(function (doc) {\n    if (doc.exists) {\n      console.log(\"Document data:\");\n      get_posts_from_post_ID_list(firebase, doc.data().posts, callback);\n    } else {\n      // doc.data() will be undefined in this case\n      console.log(\"No such document!\");\n    }\n  });\n}\n\nfunction get_posts_from_post_ID_list(firebase, pID_list, callback) {\n  for (var i = 0; i < pID_list.length; i++) {\n    get_post(firebase, pID_list[i], callback);\n  }\n}\n\nfunction get_post(firebase, post_id, callback) {\n  //get db reference\n  var db = firebase.db;\n  var docRef = db.collection(\"posts\").doc(post_id);\n  docRef.get().then(function (doc) {\n    if (doc.exists) {\n      console.log(\"Document data:\");\n      callback(doc.data());\n    } else {\n      // doc.data() will be undefined in this case\n      console.log(\"No such document!\");\n    }\n  });\n}\n\nfunction get_all_post(firebase, callback) {\n  var list_posts = [];\n  let promise = new Promise(function (resolve, reject) {\n    help_get_all_post(firebase, post => {\n      list_posts.unshift(post);\n    });\n    resolve();\n  });\n  promise.then(() => {\n    callback(list_posts);\n  });\n}\n\nfunction help_get_all_post(firebase, callback) {\n  var db = firebase.db;\n  db.collection(\"posts\").get().then(function (querySnapshot) {\n    querySnapshot.forEach(function (doc) {\n      callback(doc.data());\n    });\n  });\n}\n\nfunction fliter(firebase, list_posts, distance, user_location, callback) {\n  let location_str = \"\";\n  let mydestinations = [];\n  console.log(list_posts);\n\n  for (let i = 0; i < list_posts.length; i++) {\n    mydestinations.push(new google.maps.LatLng(list_posts[i].location.lat, list_posts[i].location.lng));\n  }\n\n  let ori = new google.maps.LatLng(user_location.lat, user_location.lng);\n  var service = new google.maps.DistanceMatrixService();\n  let return_list = [];\n  service.getDistanceMatrix({\n    origins: user_location,\n    destinations: mydestinations,\n    travelMode: 'WALKING'\n  }, () => {\n    return_list = fliter_help(response, status, distance, list_posts);\n    callback(return_list);\n  });\n}\n\nfunction fliter_help(response, status, dis, list_posts) {\n  let distances = [];\n  let return_list = [];\n\n  if (status == 'OK') {\n    var origins = response.originAddresses;\n    var destinations = response.destinationAddresses;\n\n    for (var i = 0; i < origins.length; i++) {\n      var results = response.rows[i].elements;\n\n      for (var j = 0; j < results.length; j++) {\n        var element = results[j];\n        var distance = element.distance.text;\n        distances.push(distance);\n        var duration = element.duration.text;\n        var from = origins[i];\n        var to = destinations[j];\n      }\n    }\n\n    for (let i = 0; i < distances.length; i++) {\n      if (distances[i] < dis) {\n        return_list.push(list_posts[i]);\n      }\n    }\n\n    return return_list;\n  }\n\n  return return_list;\n}\n\nexport { get_all_post_by_id, get_all_post, fliter_help };","map":{"version":3,"sources":["/Users/jiadaye/workspace/cirko/src/components/Firebase/getPosts.js"],"names":["get_all_post_by_id","firebase","user_id","callback","get_all_post_id_from_db","db","docRef","collection","doc","get","then","exists","console","log","get_posts_from_post_ID_list","data","posts","pID_list","i","length","get_post","post_id","get_all_post","list_posts","promise","Promise","resolve","reject","help_get_all_post","post","unshift","querySnapshot","forEach","fliter","distance","user_location","location_str","mydestinations","push","google","maps","LatLng","location","lat","lng","ori","service","DistanceMatrixService","return_list","getDistanceMatrix","origins","destinations","travelMode","fliter_help","response","status","dis","distances","originAddresses","destinationAddresses","results","rows","elements","j","element","text","duration","from","to"],"mappings":"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","sourcesContent":["function get_all_post_by_id(firebase,user_id, callback){\n    get_all_post_id_from_db(firebase,user_id, callback);\n}\n\n\nfunction get_all_post_id_from_db(firebase,user_id, callback){\n    //get db reference\n    var db = firebase.db;\n    var docRef = db.collection(\"users\").doc(user_id);\n    //get user\n    docRef.get().then(function(doc) {\n        if (doc.exists) {\n            console.log(\"Document data:\");\n            get_posts_from_post_ID_list(firebase,doc.data().posts, callback);\n        } else {\n            // doc.data() will be undefined in this case\n            console.log(\"No such document!\");\n        }\n    });\n}\n\nfunction get_posts_from_post_ID_list(firebase,pID_list, callback){\n    for (var i=0;i<pID_list.length;i++)\n    {\n        get_post(firebase,pID_list[i], callback);\n    }\n}\n\nfunction get_post(firebase,post_id,callback) {\n    //get db reference\n    var db = firebase.db;\n    var docRef = db.collection(\"posts\").doc(post_id);\n\n    docRef.get().then(function(doc) {\n        if (doc.exists) {\n            console.log(\"Document data:\");\n            callback(doc.data());\n        } else {\n            // doc.data() will be undefined in this case\n            console.log(\"No such document!\");\n        }\n    });\n}\nfunction get_all_post(firebase, callback){\n    var list_posts = [];\n    let promise = new Promise(function(resolve, reject){\n        help_get_all_post(firebase, (post)=>{list_posts.unshift(post);})\n        resolve()\n    });\n    promise.then(()=>{\n        callback(list_posts);\n    })\n\n}\n\nfunction help_get_all_post(firebase, callback) {\n    var db = firebase.db;\n    db.collection(\"posts\").get().then(function(querySnapshot) {\n        querySnapshot.forEach(function(doc) {\n            callback(doc.data());\n        });\n    });\n}\n\n\n\n\nfunction fliter(firebase,list_posts, distance, user_location, callback){\n    let location_str = \"\";\n    let mydestinations = [];\n    console.log(list_posts);\n    for(let i = 0; i<list_posts.length; i++) {\n        mydestinations.push(new google.maps.LatLng(list_posts[i].location.lat, list_posts[i].location.lng));\n    }\n    let ori = new google.maps.LatLng(user_location.lat, user_location.lng);\n    var service = new google.maps.DistanceMatrixService();\n    let return_list = [];\n    service.getDistanceMatrix(\n        {\n            origins: user_location,\n            destinations: mydestinations,\n            travelMode: 'WALKING'\n        }, ()=>{return_list = fliter_help(response, status, distance, list_posts)\n            callback(return_list);\n        });\n}\n\nfunction fliter_help(response, status, dis, list_posts) {\n    let distances = [];\n    let return_list = [];\n    if (status == 'OK') {\n        var origins = response.originAddresses;\n        var destinations = response.destinationAddresses;\n\n        for (var i = 0; i < origins.length; i++) {\n            var results = response.rows[i].elements;\n            for (var j = 0; j < results.length; j++) {\n                var element = results[j];\n                var distance = element.distance.text;\n                distances.push(distance);\n                var duration = element.duration.text;\n                var from = origins[i];\n                var to = destinations[j];\n            }\n        }\n\n        for(let i = 0; i < distances.length; i++) {\n            if(distances[i] < dis) {\n                return_list.push(list_posts[i]);\n            }\n        }\n        return return_list;\n    }\n    return return_list;\n}\n\n\n\n\n\n\n\n\nexport {get_all_post_by_id,get_all_post,fliter_help}"]},"metadata":{},"sourceType":"module"}