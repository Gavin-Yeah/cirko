{"ast":null,"code":"import\"antd-mobile/lib/icon/style\";import _Icon from\"antd-mobile/lib/icon\";import\"antd-mobile/lib/input-item/style\";import _InputItem from\"antd-mobile/lib/input-item\";import\"antd-mobile/lib/flex/style\";import _Flex from\"antd-mobile/lib/flex\";import\"antd-mobile/lib/slider/style\";import _Slider from\"antd-mobile/lib/slider\";import\"antd-mobile/lib/toast/style\";import _Toast from\"antd-mobile/lib/toast\";import _classCallCheck from\"/Users/jiadaye/workspace/cirko/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/jiadaye/workspace/cirko/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/jiadaye/workspace/cirko/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/jiadaye/workspace/cirko/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/jiadaye/workspace/cirko/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import*as ROUTES from\"../../../constants/routes\";import add from\"../../icons/add.png\";import{get_all_post,get_all_post_by_uid}from\"../../Firebase/getPosts\";import{get_location}from\"../../utils/getLocation\";import{withAuthentication}from\"../../Session\";import ImageContainer from\"../../ImageContainer\";import NavBar1 from\"../NavBar1\";import{likes}from\"../../Firebase/upload\";import Item from'../Item';var PostPage=/*#__PURE__*/function(_React$Component){_inherits(PostPage,_React$Component);function PostPage(props){var _this;_classCallCheck(this,PostPage);_this=_possibleConstructorReturn(this,_getPrototypeOf(PostPage).call(this,props));_this.renderItems=function(){_this.setState({isLoading:true});get_location(function(location){var callback=function callback(list){list.sort(function(a,b){return Date.parse(a.time)>=Date.parse(b.time)?-1:1;});var fliter=_this.props.firebase.functions.httpsCallable(\"fliter\");//console.log(this.state.location)\n// console.log(list[1])\nfliter([list,_this.state.distance,location]).then(function(result){// Read result of the Cloud Function.\nresult.data.sort(function(a,b){return Date.parse(a.time)>=Date.parse(b.time)?-1:1;});console.log(result.data);_this.setState({data:result.data,isLoading:false});}).catch(function(error){// Getting the Error details.\nvar code=error.code;var message=error.message;var details=error.details;console.log(\"filtererr\"+code);console.log(message);console.log(details);});_this.setState({data:list});};_this.setState({location:location},function(){return get_all_post(_this.props.firebase,callback);});});};_this.check=function(){_this.renderItems();};_this.onClickComment=function(id){_this.props.history.push(\"/home/comments/\".concat(id));};_this.clickImg=function(file){_this.setState({isImgClick:true,currentImg:file.url});};_this.picClose=function(){console.log(\"picCLose\");_this.setState({isImgClick:false});};_this.likes=function(postId){likes(_this.props.firebase,_this.props.firebase.auth.currentUser.uid,postId).then(function(result){console.log(result,postId);_this.renderItems();}).catch(function(err){console.log(err.toString());});};_this.slider=function(e){//  console.log(e)\n_this.setState({distance:e});};_this.state={isLoading:true,height:document.documentElement.clientHeight,distance:1000,currentImg:'',isImgClick:false,hasMore:false,data:[]};return _this;}_createClass(PostPage,[{key:\"componentDidMount\",value:function componentDidMount(){this.renderItems();//console.log(a)\n// console.log(this.props.firebase.db.collection(\"posts\").get())\n// you can scroll to the specified position\n// setTimeout(() => this.lv.scrollTo(0, 120), 800);\n// simulate initial Ajax\n}},{key:\"render\",value:function render(){var _this2=this;if(this.state.isLoading){_Toast.loading('Loading...',0.5,function(){console.log('Load complete !!!');});};return React.createElement(\"div\",null,this.state.isImgClick&&React.createElement(ImageContainer,{currentImg:this.state.currentImg,picClose:this.picClose}),React.createElement(NavBar1,{history:this.props.history}),React.createElement(_Flex,{style:{background:\"white\",height:\"8vh\",position:'fixed',width:\"100%\",top:\"3vh\",zIndex:1}},React.createElement(_Flex.Item,{style:{flex:'8'}},React.createElement(_Slider,{style:{marginLeft:\"10px\",marginTop:'3vh'},defaultValue:this.state.distance*1,min:0,max:30000,step:100,value:this.state.distance,onChange:function onChange(e){return _this2.slider(e);}})),React.createElement(_Flex.Item,{style:{flex:'3.5',marginTop:'3vh',marginLeft:'2.5vw',fontSize:\"20px\",background:'rgba(0,0,0,0)'}},React.createElement(_InputItem,{type:\"number\",onChange:function onChange(e){_this2.setState({distance:e});},value:this.state.distance,extra:\"m\",style:{background:'#f7f7f7'}})),React.createElement(_Flex.Item,{style:{flex:'1'}},React.createElement(_Icon,{onClick:this.check,size:\"small\",style:{borderRadius:'100%',background:\"#fbfbfb\",marginTop:'3vh',textAlign:'center',width:'30px',fontSize:\"4vh\"},type:'check'}))),React.createElement(\"div\",null,this.state.data.map(function(obj,index){return React.createElement(Item,{key:obj.post_id,index:index,obj:obj});})));}}]);return PostPage;}(React.Component);export default withAuthentication(PostPage);","map":{"version":3,"sources":["/Users/jiadaye/workspace/cirko/src/components/Home/PostPage/index.js"],"names":["React","ROUTES","add","get_all_post","get_all_post_by_uid","get_location","withAuthentication","ImageContainer","NavBar1","likes","Item","PostPage","props","renderItems","setState","isLoading","location","callback","list","sort","a","b","Date","parse","time","fliter","firebase","functions","httpsCallable","state","distance","then","result","data","console","log","catch","error","code","message","details","check","onClickComment","id","history","push","clickImg","file","isImgClick","currentImg","url","picClose","postId","auth","currentUser","uid","err","toString","slider","e","height","document","documentElement","clientHeight","hasMore","loading","background","position","width","top","zIndex","flex","marginLeft","marginTop","fontSize","borderRadius","textAlign","map","obj","index","post_id","Component"],"mappings":"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","sourcesContent":["/* eslint no-dupe-keys: 0 */\nimport { ListView, NavBar, Button, Flex, Toast, Slider, Icon, ImagePicker, InputItem, List, Switch } from 'antd-mobile';\nimport React from 'react'\n\n\n\nimport * as ROUTES from \"../../../constants/routes\";\nimport add from \"../../icons/add.png\";\nimport { get_all_post, get_all_post_by_uid } from \"../../Firebase/getPosts\";\nimport { get_location } from \"../../utils/getLocation\";\nimport { withAuthentication } from \"../../Session\";\nimport ImageContainer from \"../../ImageContainer\";\nimport NavBar1 from \"../NavBar1\";\nimport { likes } from \"../../Firebase/upload\";\nimport Item from '../Item';\n\n\nclass PostPage extends React.Component {\n\n\n    constructor(props) {\n        super(props);\n\n\n        this.state = {\n\n            isLoading: true,\n            height: document.documentElement.clientHeight,\n            distance: 1000,\n            currentImg: '',\n            isImgClick: false,\n            hasMore: false,\n            data: []\n        };\n    }\n\n    renderItems = () => {\n        this.setState({\n            isLoading: true\n        })\n        get_location((location) => {\n\n\n            const callback = (list) => {\n\n                list.sort((a, b) => {\n\n                    return Date.parse(a.time) >= Date.parse(b.time) ? -1 : 1\n                })\n                let fliter = this.props.firebase.functions.httpsCallable(\"fliter\");\n\n                //console.log(this.state.location)\n                // console.log(list[1])\n                fliter([list, this.state.distance, location]).then((result) => {\n                    // Read result of the Cloud Function.\n\n                    result.data.sort((a, b) => {\n\n                        return Date.parse(a.time) >= Date.parse(b.time) ? -1 : 1\n                    })\n                    console.log(result.data)\n                    this.setState({\n                            data: result.data,\n                            isLoading: false\n                        }\n                    )\n                }).catch(function (error) {\n                    // Getting the Error details.\n                    let code = error.code;\n                    let message = error.message;\n                    let details = error.details;\n                    console.log(\"filtererr\" + code);\n                    console.log(message);\n                    console.log(details);\n\n                });\n\n\n                this.setState({\n                    data: list\n                })\n\n            }\n\n\n            this.setState({\n                location: location\n            }, () => get_all_post(this.props.firebase, callback))\n\n\n        })\n    }\n\n    componentDidMount() {\n\n        this.renderItems();\n\n        //console.log(a)\n\n\n        // console.log(this.props.firebase.db.collection(\"posts\").get())\n        // you can scroll to the specified position\n        // setTimeout(() => this.lv.scrollTo(0, 120), 800);\n\n        // simulate initial Ajax\n\n    }\n\n    check = () => {\n        this.renderItems();\n\n    }\n\n\n    onClickComment = (id) => {\n\n        this.props.history.push(`/home/comments/${id}`)\n    }\n\n    clickImg = (file) => {\n\n        this.setState({\n            isImgClick: true,\n            currentImg: file.url\n        })\n    }\n    picClose = () => {\n        console.log(\"picCLose\")\n        this.setState({\n            isImgClick: false\n        })\n    }\n\n    likes = (postId) => {\n\n        likes(this.props.firebase, this.props.firebase.auth.currentUser.uid, postId).then((result) => {\n            console.log(result, postId);\n            this.renderItems()\n\n        }).catch(err => {\n            console.log(err.toString())\n        });\n\n    }\n\n\n    slider = (e) => {\n        //  console.log(e)\n        this.setState({\n            distance: e\n        })\n    }\n\n    render() {\n        if (this.state.isLoading) {\n            Toast.loading('Loading...', 0.5, () => {\n                console.log('Load complete !!!');\n            });\n        }\n\n        ;\n\n\n        return (\n            <div>\n                {this.state.isImgClick && <ImageContainer currentImg={this.state.currentImg} picClose={this.picClose}/>}\n                <NavBar1 history={this.props.history}/>\n\n                <Flex style={{\n                    background: \"white\",\n                    height: \"8vh\",\n                    position: 'fixed',\n                    width: \"100%\",\n                    top: \"3vh\",\n                    zIndex: 1\n                }}>\n                    <Flex.Item style={{flex: '8'}}>\n                        <Slider\n                            style={{marginLeft: \"10px\", marginTop: '3vh'}}\n                            defaultValue={this.state.distance * 1}\n                            min={0}\n                            max={30000}\n                            step={100}\n                            value={this.state.distance}\n                            onChange={(e) => this.slider(e)}\n                        />\n\n                    </Flex.Item>\n                    <Flex.Item style={{\n                        flex: '3.5',\n                        marginTop: '3vh',\n                        marginLeft: '2.5vw',\n                        fontSize: \"20px\",\n                        background: 'rgba(0,0,0,0)'\n                    }}>\n                        <InputItem\n                            type=\"number\"\n                            onChange={(e) => {\n                                this.setState({distance: e})\n                            }}\n                            value={this.state.distance}\n                            extra=\"m\"\n                            style={{background: '#f7f7f7'}}\n                        />\n                    </Flex.Item>\n                    <Flex.Item style={{flex: '1'}}>\n                        <Icon onClick={this.check} size='small' style={{\n                            borderRadius: '100%',\n                            background: \"#fbfbfb\",\n                            marginTop: '3vh',\n                            textAlign: 'center',\n                            width: '30px',\n                            fontSize: \"4vh\"\n                        }} type={'check'}/>\n                    </Flex.Item>\n                </Flex>\n                <div>\n                    {\n                        this.state.data.map((obj, index) => {\n                            return (\n                                <Item key={obj.post_id} index={index} obj={obj}/>\n                            )\n                        })\n                    }\n\n                </div>\n\n            </div>\n        );\n    }\n}\n\nexport default withAuthentication(PostPage);\n\n"]},"metadata":{},"sourceType":"module"}