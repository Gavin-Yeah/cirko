{"ast":null,"code":"function get_all_post_by_id(firebase, user_id, callback) {\n  get_all_post_id_from_db(firebase, user_id, callback);\n}\n\nfunction get_all_post_id_from_db(firebase, user_id, callback) {\n  //get db reference\n  var db = firebase.db;\n  var docRef = db.collection(\"users\").doc(user_id); //get user\n\n  docRef.get().then(function (doc) {\n    if (doc.exists) {\n      console.log(\"Document data:\");\n      get_posts_from_post_ID_list(firebase, doc.data().posts, callback);\n    } else {\n      // doc.data() will be undefined in this case\n      console.log(\"No such document!\");\n    }\n  });\n}\n\nfunction get_posts_from_post_ID_list(firebase, pID_list, callback) {\n  for (var i = 0; i < pID_list.length; i++) {\n    get_post(firebase, pID_list[i], callback);\n  }\n}\n\nconst get_post = (firebase, post_id, callback) => {\n  //get db reference\n  var db = firebase.db;\n  var docRef = db.collection(\"posts\").doc(post_id);\n  docRef.get().then(function (doc) {\n    if (doc.exists) {\n      console.log(\"Document data:\");\n      callback(doc.data());\n    } else {\n      // doc.data() will be undefined in this case\n      console.log(\"No such document!\");\n    }\n  });\n};\n\nfunction get_all_post(firebase, callback) {\n  let promise = new Promise(function (resolve, reject) {\n    var list_posts = [];\n    help_get_all_post(firebase, post => {\n      list_posts.unshift(post);\n      resolve(list_posts);\n    });\n  });\n  promise.then(data => {\n    console.log(data);\n    callback(data);\n  });\n}\n\nfunction help_get_all_post(firebase, callback) {\n  var db = firebase.db;\n  db.collection(\"posts\").get().then(function (querySnapshot) {\n    querySnapshot.forEach(function (doc) {\n      callback(doc.data());\n    });\n  });\n} // function fliter(firebase,list_posts, distance, user_location, callback){\n//     let location_str = \"\";\n//     let mydestinations = [];\n//     console.log(list_posts);\n//     for(let i = 0; i<list_posts.length; i++) {\n//         mydestinations.push(new google.maps.LatLng(list_posts[i].location.lat, list_posts[i].location.lng));\n//     }\n//     let ori = new google.maps.LatLng(user_location.lat, user_location.lng);\n//     var service = new google.maps.DistanceMatrixService();\n//     let return_list = [];\n//     service.getDistanceMatrix(\n//         {\n//             origins: user_location,\n//             destinations: mydestinations,\n//             travelMode: 'WALKING'\n//         }, ()=>{return_list = fliter_help(response, status, distance, list_posts)\n//             callback(return_list);\n//         });\n// }\n//\n// function fliter_help(response, status, dis, list_posts) {\n//     let distances = [];\n//     let return_list = [];\n//     if (status == 'OK') {\n//         var origins = response.originAddresses;\n//         var destinations = response.destinationAddresses;\n//\n//         for (var i = 0; i < origins.length; i++) {\n//             var results = response.rows[i].elements;\n//             for (var j = 0; j < results.length; j++) {\n//                 var element = results[j];\n//                 var distance = element.distance.text;\n//                 distances.push(distance);\n//                 var duration = element.duration.text;\n//                 var from = origins[i];\n//                 var to = destinations[j];\n//             }\n//         }\n//\n//         for(let i = 0; i < distances.length; i++) {\n//             if(distances[i] < dis) {\n//                 return_list.push(list_posts[i]);\n//             }\n//         }\n//         return return_list;\n//     }\n//     return return_list;\n// }\n\n\nexport { get_all_post_by_id, get_all_post, get_post };","map":{"version":3,"sources":["/Users/jiadaye/workspace/cirko/src/components/Firebase/getPosts.js"],"names":["get_all_post_by_id","firebase","user_id","callback","get_all_post_id_from_db","db","docRef","collection","doc","get","then","exists","console","log","get_posts_from_post_ID_list","data","posts","pID_list","i","length","get_post","post_id","get_all_post","promise","Promise","resolve","reject","list_posts","help_get_all_post","post","unshift","querySnapshot","forEach"],"mappings":"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","sourcesContent":["function get_all_post_by_id(firebase,user_id, callback){\n    get_all_post_id_from_db(firebase,user_id, callback);\n}\n\n\nfunction get_all_post_id_from_db(firebase,user_id, callback){\n    //get db reference\n    var db = firebase.db;\n    var docRef = db.collection(\"users\").doc(user_id);\n    //get user\n    docRef.get().then(function(doc) {\n        if (doc.exists) {\n            console.log(\"Document data:\");\n            get_posts_from_post_ID_list(firebase,doc.data().posts, callback);\n        } else {\n            // doc.data() will be undefined in this case\n            console.log(\"No such document!\");\n        }\n    });\n}\n\nfunction get_posts_from_post_ID_list(firebase,pID_list, callback){\n    for (var i=0;i<pID_list.length;i++)\n    {\n        get_post(firebase,pID_list[i], callback);\n    }\n}\n\nconst get_post = (firebase,post_id,callback) => {\n    //get db reference\n    var db = firebase.db;\n    var docRef = db.collection(\"posts\").doc(post_id);\n\n    docRef.get().then(function(doc) {\n        if (doc.exists) {\n            console.log(\"Document data:\");\n            callback(doc.data());\n        } else {\n            // doc.data() will be undefined in this case\n            console.log(\"No such document!\");\n        }\n    });\n}\nfunction get_all_post(firebase, callback){\n\n    let promise = new Promise(function(resolve, reject){\n        var list_posts = [];\n        help_get_all_post(firebase, (post)=>{list_posts.unshift(post);\n\n            resolve(list_posts)\n\n        })\n\n    });\n    promise.then((data)=>{\n        console.log(data)\n        callback(data);\n    })\n\n}\n\nfunction help_get_all_post(firebase, callback) {\n    var db = firebase.db;\n    db.collection(\"posts\").get().then(function(querySnapshot) {\n        querySnapshot.forEach(function(doc) {\n            callback(doc.data());\n        });\n    });\n}\n\n\n\n\n// function fliter(firebase,list_posts, distance, user_location, callback){\n//     let location_str = \"\";\n//     let mydestinations = [];\n//     console.log(list_posts);\n//     for(let i = 0; i<list_posts.length; i++) {\n//         mydestinations.push(new google.maps.LatLng(list_posts[i].location.lat, list_posts[i].location.lng));\n//     }\n//     let ori = new google.maps.LatLng(user_location.lat, user_location.lng);\n//     var service = new google.maps.DistanceMatrixService();\n//     let return_list = [];\n//     service.getDistanceMatrix(\n//         {\n//             origins: user_location,\n//             destinations: mydestinations,\n//             travelMode: 'WALKING'\n//         }, ()=>{return_list = fliter_help(response, status, distance, list_posts)\n//             callback(return_list);\n//         });\n// }\n//\n// function fliter_help(response, status, dis, list_posts) {\n//     let distances = [];\n//     let return_list = [];\n//     if (status == 'OK') {\n//         var origins = response.originAddresses;\n//         var destinations = response.destinationAddresses;\n//\n//         for (var i = 0; i < origins.length; i++) {\n//             var results = response.rows[i].elements;\n//             for (var j = 0; j < results.length; j++) {\n//                 var element = results[j];\n//                 var distance = element.distance.text;\n//                 distances.push(distance);\n//                 var duration = element.duration.text;\n//                 var from = origins[i];\n//                 var to = destinations[j];\n//             }\n//         }\n//\n//         for(let i = 0; i < distances.length; i++) {\n//             if(distances[i] < dis) {\n//                 return_list.push(list_posts[i]);\n//             }\n//         }\n//         return return_list;\n//     }\n//     return return_list;\n// }\n\n\n\n\n\n\n\n\nexport {get_all_post_by_id,get_all_post, get_post}"]},"metadata":{},"sourceType":"module"}