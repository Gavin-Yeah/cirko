{"ast":null,"code":"async function get_all_post_by_id(firebase, user_id) {\n  //get db reference\n  var db = firebase.db;\n  var docRef = db.collection(\"users\").doc(user_id); //get user\n\n  let doc = await docRef.get();\n\n  if (doc.exists) {\n    return await get_posts_from_post_ID_list(firebase, doc.data().posts);\n  } else {\n    // doc.data() will be undefined in this case\n    console.log(\"No such document!\");\n  }\n}\n\nasync function get_all_liked_posts(firebase, user_id) {\n  var db = firebase.db;\n  var docRef = db.collection(\"users\").doc(user_id); //get user\n\n  let doc = await docRef.get();\n\n  if (doc.exists) {\n    return await get_posts_from_post_ID_list(firebase, doc.data().likes);\n  } else {\n    // doc.data() will be undefined in this case\n    console.log(\"No such document!\");\n  }\n}\n\nfunction get_all_post_id_from_db(firebase, user_id, callback) {\n  //get db reference\n  var db = firebase.db;\n  var docRef = db.collection(\"users\").doc(user_id); //get user\n\n  docRef.get().then(function (doc) {\n    if (doc.exists) {\n      console.log(\"Document data:\");\n      get_posts_from_post_ID_list(firebase, doc.data().posts, callback);\n    } else {\n      // doc.data() will be undefined in this case\n      console.log(\"No such document!\");\n    }\n  });\n}\n\nasync function get_posts_from_post_ID_list(firebase, pID_list) {\n  var list_posts = [];\n\n  for (var i = 0; i < pID_list.length; i++) {\n    let post = await get_post(firebase, pID_list[i]);\n\n    if (post) {\n      list_posts.unshift(post);\n    }\n  }\n\n  return list_posts;\n}\n\nasync function get_post(firebase, post_id) {\n  //get db reference\n  var db = firebase.db;\n  var docRef = db.collection(\"posts\").doc(post_id);\n  var doc = await docRef.get();\n\n  if (doc.exists) {\n    return doc.data();\n  } else {\n    // doc.data() will be undefined in this case\n    console.log(\"No such document!\");\n  }\n\n  return;\n}\n\nfunction get_all_post(firebase, callback) {\n  let promise = new Promise(function (resolve, reject) {\n    var list_posts = [];\n    help_get_all_post(firebase, post => {\n      list_posts.unshift(post);\n      resolve(list_posts);\n    });\n  });\n  promise.then(data => {\n    // console.log(data)\n    callback(data);\n  });\n}\n\nfunction help_get_all_post(firebase, callback) {\n  var db = firebase.db;\n  db.collection(\"posts\").get().then(function (querySnapshot) {\n    querySnapshot.forEach(function (doc) {\n      callback(doc.data());\n    });\n  });\n} // function fliter(firebase,list_posts, distance, user_location, callback){\n//     let location_str = \"\";\n//     let mydestinations = [];\n//     console.log(list_posts);\n//     for(let i = 0; i<list_posts.length; i++) {\n//         mydestinations.push(new google.maps.LatLng(list_posts[i].location.lat, list_posts[i].location.lng));\n//     }\n//     let ori = new google.maps.LatLng(user_location.lat, user_location.lng);\n//     var service = new google.maps.DistanceMatrixService();\n//     let return_list = [];\n//     service.getDistanceMatrix(\n//         {\n//             origins: user_location,\n//             destinations: mydestinations,\n//             travelMode: 'WALKING'\n//         }, ()=>{return_list = fliter_help(response, status, distance, list_posts)\n//             callback(return_list);\n//         });\n// }\n//\n// function fliter_help(response, status, dis, list_posts) {\n//     let distances = [];\n//     let return_list = [];\n//     if (status == 'OK') {\n//         var origins = response.originAddresses;\n//         var destinations = response.destinationAddresses;\n//\n//         for (var i = 0; i < origins.length; i++) {\n//             var results = response.rows[i].elements;\n//             for (var j = 0; j < results.length; j++) {\n//                 var element = results[j];\n//                 var distance = element.distance.text;\n//                 distances.push(distance);\n//                 var duration = element.duration.text;\n//                 var from = origins[i];\n//                 var to = destinations[j];\n//             }\n//         }\n//\n//         for(let i = 0; i < distances.length; i++) {\n//             if(distances[i] < dis) {\n//                 return_list.push(list_posts[i]);\n//             }\n//         }\n//         return return_list;\n//     }\n//     return return_list;\n// }\n\n\nexport { get_all_post_by_id, get_all_post, get_post, get_all_liked_posts };","map":{"version":3,"sources":["/Users/jiadaye/workspace/cirko/src/components/Firebase/getPosts.js"],"names":["get_all_post_by_id","firebase","user_id","db","docRef","collection","doc","get","exists","get_posts_from_post_ID_list","data","posts","console","log","get_all_liked_posts","likes","get_all_post_id_from_db","callback","then","pID_list","list_posts","i","length","post","get_post","unshift","post_id","get_all_post","promise","Promise","resolve","reject","help_get_all_post","querySnapshot","forEach"],"mappings":"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ACP,IAAD,CAAR;AACH,GAHD;AAKH;;AAED,SAASsB,iBAAT,CAA2B/B,QAA3B,EAAqCgB,QAArC,EAA+C;AAC3C,MAAId,EAAE,GAAGF,QAAQ,CAACE,EAAlB;AACAA,EAAAA,EAAE,CAACE,UAAH,CAAc,OAAd,EAAuBE,GAAvB,GAA6BW,IAA7B,CAAkC,UAASe,aAAT,EAAwB;AACtDA,IAAAA,aAAa,CAACC,OAAd,CAAsB,UAAS5B,GAAT,EAAc;AAChCW,MAAAA,QAAQ,CAACX,GAAG,CAACI,IAAJ,EAAD,CAAR;AACH,KAFD;AAGH,GAJD;AAKH,C,CAKD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AASA,SAAQV,kBAAR,EAA2B2B,YAA3B,EAAyCH,QAAzC,EAAkDV,mBAAlD","sourcesContent":["async function get_all_post_by_id(firebase, user_id) {\n    //get db reference\n    var db = firebase.db;\n    var docRef = db.collection(\"users\").doc(user_id);\n    //get user\n    let doc = await docRef.get();\n    if (doc.exists) {\n        return await get_posts_from_post_ID_list(firebase, doc.data().posts);\n    } else {\n        // doc.data() will be undefined in this case\n        console.log(\"No such document!\");\n    }\n}\n\n\nasync function get_all_liked_posts(firebase, user_id) {\n\n\n    var db = firebase.db;\n    var docRef = db.collection(\"users\").doc(user_id);\n    //get user\n    let doc = await docRef.get();\n    if (doc.exists) {\n        return await get_posts_from_post_ID_list(firebase, doc.data().likes);\n    } else {\n        // doc.data() will be undefined in this case\n        console.log(\"No such document!\");\n    }\n\n}\n\n\n\nfunction get_all_post_id_from_db(firebase,user_id, callback){\n    //get db reference\n    var db = firebase.db;\n    var docRef = db.collection(\"users\").doc(user_id);\n    //get user\n    docRef.get().then(function(doc) {\n        if (doc.exists) {\n            console.log(\"Document data:\");\n            get_posts_from_post_ID_list(firebase,doc.data().posts, callback);\n        } else {\n            // doc.data() will be undefined in this case\n            console.log(\"No such document!\");\n        }\n    });\n}\n\nasync function get_posts_from_post_ID_list(firebase, pID_list) {\n    var list_posts = [];\n    for (var i = 0; i < pID_list.length; i++) {\n        let post = await get_post(firebase, pID_list[i]);\n        if(post){\n            list_posts.unshift(post);\n        }\n\n    }\n    return list_posts;\n}\n\nasync function get_post(firebase, post_id){\n    //get db reference\n    var db = firebase.db;\n    var docRef = db.collection(\"posts\").doc(post_id);\n\n    var doc = await docRef.get();\n    if (doc.exists) {\n        return(doc.data());\n    } else {\n        // doc.data() will be undefined in this case\n        console.log(\"No such document!\");\n    }\n    return ;\n\n}\nfunction get_all_post(firebase, callback){\n\n    let promise = new Promise(function(resolve, reject){\n        var list_posts = [];\n        help_get_all_post(firebase, (post)=>{list_posts.unshift(post);\n\n            resolve(list_posts)\n\n        })\n\n    });\n    promise.then((data)=>{\n        // console.log(data)\n        callback(data);\n    })\n\n}\n\nfunction help_get_all_post(firebase, callback) {\n    var db = firebase.db;\n    db.collection(\"posts\").get().then(function(querySnapshot) {\n        querySnapshot.forEach(function(doc) {\n            callback(doc.data());\n        });\n    });\n}\n\n\n\n\n// function fliter(firebase,list_posts, distance, user_location, callback){\n//     let location_str = \"\";\n//     let mydestinations = [];\n//     console.log(list_posts);\n//     for(let i = 0; i<list_posts.length; i++) {\n//         mydestinations.push(new google.maps.LatLng(list_posts[i].location.lat, list_posts[i].location.lng));\n//     }\n//     let ori = new google.maps.LatLng(user_location.lat, user_location.lng);\n//     var service = new google.maps.DistanceMatrixService();\n//     let return_list = [];\n//     service.getDistanceMatrix(\n//         {\n//             origins: user_location,\n//             destinations: mydestinations,\n//             travelMode: 'WALKING'\n//         }, ()=>{return_list = fliter_help(response, status, distance, list_posts)\n//             callback(return_list);\n//         });\n// }\n//\n// function fliter_help(response, status, dis, list_posts) {\n//     let distances = [];\n//     let return_list = [];\n//     if (status == 'OK') {\n//         var origins = response.originAddresses;\n//         var destinations = response.destinationAddresses;\n//\n//         for (var i = 0; i < origins.length; i++) {\n//             var results = response.rows[i].elements;\n//             for (var j = 0; j < results.length; j++) {\n//                 var element = results[j];\n//                 var distance = element.distance.text;\n//                 distances.push(distance);\n//                 var duration = element.duration.text;\n//                 var from = origins[i];\n//                 var to = destinations[j];\n//             }\n//         }\n//\n//         for(let i = 0; i < distances.length; i++) {\n//             if(distances[i] < dis) {\n//                 return_list.push(list_posts[i]);\n//             }\n//         }\n//         return return_list;\n//     }\n//     return return_list;\n// }\n\n\n\n\n\n\n\n\nexport {get_all_post_by_id,get_all_post, get_post,get_all_liked_posts}"]},"metadata":{},"sourceType":"module"}