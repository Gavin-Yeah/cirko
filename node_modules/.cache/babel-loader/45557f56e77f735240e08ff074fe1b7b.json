{"ast":null,"code":"import \"antd-mobile/lib/icon/style\";\nimport _Icon from \"antd-mobile/lib/icon\";\nimport \"antd-mobile/lib/input-item/style\";\nimport _InputItem from \"antd-mobile/lib/input-item\";\nimport \"antd-mobile/lib/flex/style\";\nimport _Flex from \"antd-mobile/lib/flex\";\nimport \"antd-mobile/lib/slider/style\";\nimport _Slider from \"antd-mobile/lib/slider\";\nimport \"antd-mobile/lib/toast/style\";\nimport _Toast from \"antd-mobile/lib/toast\";\nvar _jsxFileName = \"/Users/jiadaye/workspace/cirko/src/components/Home/PostPage/index.js\";\nimport React from 'react';\nimport * as ROUTES from \"../../../constants/routes\";\nimport add from \"../../icons/add.png\";\nimport { get_all_post, get_all_post_by_uid } from \"../../Firebase/getPosts\";\nimport { get_location } from \"../../utils/getLocation\";\nimport { withAuthentication } from \"../../Session\";\nimport ImageContainer from \"../../ImageContainer\";\nimport NavBar1 from \"../NavBar1\";\nimport { likes } from \"../../Firebase/upload\";\nimport Item from '../Item';\n\nclass PostPage extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.renderItems = () => {\n      this.setState({\n        isLoading: true\n      });\n      get_location(location => {\n        const callback = list => {\n          list.sort((a, b) => {\n            return Date.parse(a.time) >= Date.parse(b.time) ? -1 : 1;\n          });\n          let fliter = this.props.firebase.functions.httpsCallable(\"fliter\"); //console.log(this.state.location)\n          // console.log(list[1])\n\n          fliter([list, this.state.distance, location]).then(result => {\n            // Read result of the Cloud Function.\n            result.data.sort((a, b) => {\n              return Date.parse(a.time) >= Date.parse(b.time) ? -1 : 1;\n            });\n            console.log(result.data);\n            this.setState({\n              data: result.data,\n              isLoading: false\n            });\n          }).catch(function (error) {\n            // Getting the Error details.\n            let code = error.code;\n            let message = error.message;\n            let details = error.details;\n            console.log(\"filtererr\" + code);\n            console.log(message);\n            console.log(details);\n          });\n          this.setState({\n            data: list\n          });\n        };\n\n        this.setState({\n          location: location\n        }, () => get_all_post(this.props.firebase, callback));\n      });\n    };\n\n    this.check = () => {\n      this.renderItems();\n    };\n\n    this.slider = e => {\n      //  console.log(e)\n      this.setState({\n        distance: e\n      });\n    };\n\n    this.state = {\n      isLoading: true,\n      height: document.documentElement.clientHeight,\n      distance: 1000,\n      currentImg: '',\n      isImgClick: false,\n      hasMore: false,\n      data: []\n    };\n  }\n\n  componentDidMount() {\n    this.renderItems(); //console.log(a)\n    // console.log(this.props.firebase.db.collection(\"posts\").get())\n    // you can scroll to the specified position\n    // setTimeout(() => this.lv.scrollTo(0, 120), 800);\n    // simulate initial Ajax\n  }\n\n  render() {\n    if (this.state.isLoading) {\n      _Toast.loading('Loading...', 0.5, () => {\n        console.log('Load complete !!!');\n      });\n    }\n\n    ;\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137\n      },\n      __self: this\n    }, this.state.isImgClick && React.createElement(ImageContainer, {\n      currentImg: this.state.currentImg,\n      picClose: this.picClose,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138\n      },\n      __self: this\n    }), React.createElement(NavBar1, {\n      history: this.props.history,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139\n      },\n      __self: this\n    }), React.createElement(_Flex, {\n      style: {\n        background: \"white\",\n        height: \"8vh\",\n        position: 'fixed',\n        width: \"100%\",\n        top: \"3vh\",\n        zIndex: 1\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141\n      },\n      __self: this\n    }, React.createElement(_Flex.Item, {\n      style: {\n        flex: '8'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149\n      },\n      __self: this\n    }, React.createElement(_Slider, {\n      style: {\n        marginLeft: \"10px\",\n        marginTop: '3vh'\n      },\n      defaultValue: this.state.distance * 1,\n      min: 0,\n      max: 30000,\n      step: 100,\n      value: this.state.distance,\n      onChange: e => this.slider(e),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150\n      },\n      __self: this\n    })), React.createElement(_Flex.Item, {\n      style: {\n        flex: '3.5',\n        marginTop: '3vh',\n        marginLeft: '2.5vw',\n        fontSize: \"20px\",\n        background: 'rgba(0,0,0,0)'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161\n      },\n      __self: this\n    }, React.createElement(_InputItem, {\n      type: \"number\",\n      onChange: e => {\n        this.setState({\n          distance: e\n        });\n      },\n      value: this.state.distance,\n      extra: \"m\",\n      style: {\n        background: '#f7f7f7'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168\n      },\n      __self: this\n    })), React.createElement(_Flex.Item, {\n      style: {\n        flex: '1'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178\n      },\n      __self: this\n    }, React.createElement(_Icon, {\n      onClick: this.check,\n      size: \"small\",\n      style: {\n        borderRadius: '100%',\n        background: \"#fbfbfb\",\n        marginTop: '3vh',\n        textAlign: 'center',\n        width: '30px',\n        fontSize: \"4vh\"\n      },\n      type: 'check',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179\n      },\n      __self: this\n    }))), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189\n      },\n      __self: this\n    }, this.state.data.map((obj, index) => {\n      return React.createElement(Item, Object.assign({\n        key: obj.post_id,\n        index: index,\n        obj: obj\n      }, this.props, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }));\n    })));\n  }\n\n}\n\nexport default withAuthentication(PostPage);","map":{"version":3,"sources":["/Users/jiadaye/workspace/cirko/src/components/Home/PostPage/index.js"],"names":["React","ROUTES","add","get_all_post","get_all_post_by_uid","get_location","withAuthentication","ImageContainer","NavBar1","likes","Item","PostPage","Component","constructor","props","renderItems","setState","isLoading","location","callback","list","sort","a","b","Date","parse","time","fliter","firebase","functions","httpsCallable","state","distance","then","result","data","console","log","catch","error","code","message","details","check","slider","e","height","document","documentElement","clientHeight","currentImg","isImgClick","hasMore","componentDidMount","render","loading","picClose","history","background","position","width","top","zIndex","flex","marginLeft","marginTop","fontSize","borderRadius","textAlign","map","obj","index","post_id"],"mappings":"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","sourcesContent":["/* eslint no-dupe-keys: 0 */\nimport { ListView, NavBar, Button, Flex, Toast, Slider, Icon, ImagePicker, InputItem, List, Switch } from 'antd-mobile';\nimport React from 'react'\n\n\n\nimport * as ROUTES from \"../../../constants/routes\";\nimport add from \"../../icons/add.png\";\nimport { get_all_post, get_all_post_by_uid } from \"../../Firebase/getPosts\";\nimport { get_location } from \"../../utils/getLocation\";\nimport { withAuthentication } from \"../../Session\";\nimport ImageContainer from \"../../ImageContainer\";\nimport NavBar1 from \"../NavBar1\";\nimport { likes } from \"../../Firebase/upload\";\nimport Item from '../Item';\n\n\nclass PostPage extends React.Component {\n\n\n    constructor(props) {\n        super(props);\n\n\n        this.state = {\n\n            isLoading: true,\n            height: document.documentElement.clientHeight,\n            distance: 1000,\n            currentImg: '',\n            isImgClick: false,\n            hasMore: false,\n            data: []\n        };\n    }\n\n    renderItems = () => {\n        this.setState({\n            isLoading: true\n        })\n        get_location((location) => {\n\n\n            const callback = (list) => {\n\n                list.sort((a, b) => {\n\n                    return Date.parse(a.time) >= Date.parse(b.time) ? -1 : 1\n                })\n                let fliter = this.props.firebase.functions.httpsCallable(\"fliter\");\n\n                //console.log(this.state.location)\n                // console.log(list[1])\n                fliter([list, this.state.distance, location]).then((result) => {\n                    // Read result of the Cloud Function.\n\n                    result.data.sort((a, b) => {\n\n                        return Date.parse(a.time) >= Date.parse(b.time) ? -1 : 1\n                    })\n                    console.log(result.data)\n                    this.setState({\n                            data: result.data,\n                            isLoading: false\n                        }\n                    )\n                }).catch(function (error) {\n                    // Getting the Error details.\n                    let code = error.code;\n                    let message = error.message;\n                    let details = error.details;\n                    console.log(\"filtererr\" + code);\n                    console.log(message);\n                    console.log(details);\n\n                });\n\n\n                this.setState({\n                    data: list\n                })\n\n            }\n\n\n            this.setState({\n                location: location\n            }, () => get_all_post(this.props.firebase, callback))\n\n\n        })\n    }\n\n    componentDidMount() {\n\n        this.renderItems();\n\n        //console.log(a)\n\n\n        // console.log(this.props.firebase.db.collection(\"posts\").get())\n        // you can scroll to the specified position\n        // setTimeout(() => this.lv.scrollTo(0, 120), 800);\n\n        // simulate initial Ajax\n\n    }\n\n    check = () => {\n        this.renderItems();\n\n    }\n\n\n\n\n\n\n    slider = (e) => {\n        //  console.log(e)\n        this.setState({\n            distance: e\n        })\n    }\n\n    render() {\n        if (this.state.isLoading) {\n            Toast.loading('Loading...', 0.5, () => {\n                console.log('Load complete !!!');\n            });\n        }\n\n        ;\n\n\n        return (\n            <div>\n                {this.state.isImgClick && <ImageContainer currentImg={this.state.currentImg} picClose={this.picClose}/>}\n                <NavBar1 history={this.props.history}/>\n\n                <Flex style={{\n                    background: \"white\",\n                    height: \"8vh\",\n                    position: 'fixed',\n                    width: \"100%\",\n                    top: \"3vh\",\n                    zIndex: 1\n                }}>\n                    <Flex.Item style={{flex: '8'}}>\n                        <Slider\n                            style={{marginLeft: \"10px\", marginTop: '3vh'}}\n                            defaultValue={this.state.distance * 1}\n                            min={0}\n                            max={30000}\n                            step={100}\n                            value={this.state.distance}\n                            onChange={(e) => this.slider(e)}\n                        />\n\n                    </Flex.Item>\n                    <Flex.Item style={{\n                        flex: '3.5',\n                        marginTop: '3vh',\n                        marginLeft: '2.5vw',\n                        fontSize: \"20px\",\n                        background: 'rgba(0,0,0,0)'\n                    }}>\n                        <InputItem\n                            type=\"number\"\n                            onChange={(e) => {\n                                this.setState({distance: e})\n                            }}\n                            value={this.state.distance}\n                            extra=\"m\"\n                            style={{background: '#f7f7f7'}}\n                        />\n                    </Flex.Item>\n                    <Flex.Item style={{flex: '1'}}>\n                        <Icon onClick={this.check} size='small' style={{\n                            borderRadius: '100%',\n                            background: \"#fbfbfb\",\n                            marginTop: '3vh',\n                            textAlign: 'center',\n                            width: '30px',\n                            fontSize: \"4vh\"\n                        }} type={'check'}/>\n                    </Flex.Item>\n                </Flex>\n                <div>\n                    {\n                        this.state.data.map((obj, index) => {\n                            return (\n                                <Item key={obj.post_id} index={index} obj={obj} {...this.props}/>\n                            )\n                        })\n                    }\n\n                </div>\n\n            </div>\n        );\n    }\n}\n\nexport default withAuthentication(PostPage);\n\n"]},"metadata":{},"sourceType":"module"}